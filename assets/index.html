<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <title>Поиск слова</title>

    <script>
        async function submit() {
  setLoading(true);
  const url = document.getElementById("img-url").value;
  if (!url) {
    error("Урл не может быть пустым!")
    return;
  }
  try {
    const resp = await fetch('/search', {
      method: "POST",
      body: url
    });
    if (!resp.ok) {
      error("Не могу сконвертировать :'(")
      return;
    }
    const txtRaw = await resp.text();
    console.log(txtRaw.split("\n").length);
    const txtCleaned = txtRaw.replaceAll("\n", "<br/>");
    console.log(txtCleaned.split("<br/>").length);
    console.log(txtCleaned)
    document.getElementById("txtsearch").innerHTML = txtCleaned;
	if (!((txtCleaned == null) || (txtCleaned == "null"))) {
    	succ("Слово найдено!");
	} else {
		succ("Слово не найдено!");	
	}
  } catch (e) {
    error("Не могу сконвертировать :'(")
  }
}


function clearStatus() {
  document.getElementById("alert").innerHTML = "";
}

function status(msg, type) {
  document.getElementById("alert").innerHTML = `
    <div class="alert alert-${type}" role="alert">
      ${msg}
    </div>
  `;
}

function warn(msg) {
  status(msg, "warning");
}

function succ(msg) {
  status(msg, "success");
}

function info(msg) {
  status(msg, "info");
}

function error(msg) {
  status(msg, "danger");
}

function setLoading(isLoading) {
  if (isLoading) {
    const spinner = `
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>`;
    status(spinner, "info");
  } else {
    clearStatus();
  }
}
    </script>
</head>
<body>

    <div class="container" style="max-width:700px;margin-top:10vh;">
        <div class="row">
            <div class="col-sm-10">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="inputGroup-sizing-default">Слово для поиска:</span>
                    <input type="text"
                            id="img-url"
                            class="form-control"
                            placeholder="Например, бизнес"
                            aria-label="Sizing example input"
                            aria-describedby="inputGroup-sizing-default"
                    >
                </div>
            </div>
            <div class="col-sm-2">
                <button type="submit" class="btn btn-outline-primary" onclick="submit()">
                    Поиск
                </button>
            </div>
        </div>
        <div class="row" id="alert">
        </div>
        <div class="row">
            <span id="txtsearch" style="font-size:12px; font-family:monospace;">

            </span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script>
        window.onload = () => {
            if (window.location.href.includes('test')) {
                document.getElementById("img-url").value = 'https://i.ibb.co/6DYM05G/edu0.jpg';
            }
        }
    </script>
</body>
</html>